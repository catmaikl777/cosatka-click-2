<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=0"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <title>–ö–æ—Å–∞—Ç–∫–∞ –ö–ª–∏–∫: –ö–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Roboto", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #0a0e2a, #1a1f4b, #2d2366);
        color: #fff;
        min-height: 100vh;
        overflow-x: hidden;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="10" cy="10" r="1" fill="white" opacity="0.7"/><circle cx="50" cy="20" r="1" fill="white" opacity="0.5"/><circle cx="80" cy="40" r="1" fill="white" opacity="0.8"/><circle cx="30" cy="70" r="1" fill="white" opacity="0.6"/><circle cx="70" cy="80" r="1" fill="white" opacity="0.9"/></svg>');
        background-color: #1a1f4b;
      }

      h1,
      h2,
      h3 {
        font-family: "Press Start 2P", cursive;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        text-align: center;
        padding: 20px 0;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 30px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      }

      h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        background: linear-gradient(90deg, #ff9a9e, #fad0c4, #fad0c4, #a1c4fd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 10px rgba(255, 154, 158, 0.5);
      }

      .subtitle {
        font-size: 1.2rem;
        color: #a1c4fd;
        margin-bottom: 15px;
      }

      .game-area {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
      }

      .main-game {
        flex: 1;
        min-width: 300px;
        background: rgba(10, 14, 42, 0.7);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 2px solid #4a3f7d;
      }

      .player-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #4a3f7d;
      }

      .resource {
        text-align: center;
        flex: 1;
      }

      .resource-label {
        font-size: 0.9rem;
        color: #a1c4fd;
        margin-bottom: 5px;
      }

      .resource-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #ff9a9e;
        text-shadow: 0 0 5px rgba(255, 154, 158, 0.7);
      }

      .kosatka-area {
        position: relative;
        height: 300px;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%230d0f2a"/><circle cx="20" cy="20" r="3" fill="%233a3d6b"/><circle cx="60" cy="40" r="5" fill="%233a3d6b"/><circle cx="80" cy="70" r="4" fill="%233a3d6b"/><circle cx="40" cy="80" r="6" fill="%233a3d6b"/></svg>');
        border-radius: 10px;
        margin-bottom: 20px;
        overflow: hidden;
        cursor: pointer;
        border: 2px solid #4a3f7d;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #0d0f2a;
      }

      .kosatka-img {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background-repeat: no-repeat;
        transition: transform 0.2s;
      }

      .kosatka-img img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        max-width: 200px;
        max-height: 200px;
        transition: all 0.3s ease;
      }

      .kosatka-area:active .kosatka-img {
        transform: scale(0.95);
      }

      .kosatka-click {
        position: absolute;
        width: 30px;
        height: 30px;
        background: radial-gradient(
          circle,
          rgba(255, 215, 0, 0.8) 0%,
          rgba(255, 140, 0, 0) 70%
        );
        border-radius: 50%;
        pointer-events: none;
        animation: clickEffect 0.5s forwards;
      }

      @keyframes clickEffect {
        0% {
          transform: scale(0.5);
          opacity: 1;
        }
        100% {
          transform: scale(2);
          opacity: 0;
        }
      }

      .fish-particle {
        position: absolute;
        width: 20px;
        height: 10px;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 10"><path d="M0,5 Q10,0 20,5 Q10,10 0,5" fill="%23ff9a9e"/></svg>');
        background-size: contain;
        pointer-events: none;
        animation: fishFloat 3s linear forwards;
      }

      @keyframes fishFloat {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }

      .upgrades {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
      }

      .upgrade {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        border: 1px solid #4a3f7d;
        position: relative;
        overflow: hidden;
      }

      .upgrade:hover {
        background: rgba(74, 63, 125, 0.3);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .upgrade.disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .upgrade.disabled:hover {
        transform: none;
        background: rgba(0, 0, 0, 0.3);
      }

      .upgrade-title {
        font-weight: bold;
        margin-bottom: 5px;
        color: #fad0c4;
      }

      .upgrade-description {
        font-size: 0.8rem;
        margin-bottom: 10px;
        color: #a1c4fd;
      }

      .upgrade-cost {
        color: #ff9a9e;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
      }

      .upgrade-cost::before {
        content: "üêü";
        margin-right: 5px;
      }

      .upgrade-owned {
        color: #a1c4fd;
        font-size: 0.8rem;
      }

      .right-column {
        flex: 0 0 300px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .online-players {
        background: rgba(10, 14, 42, 0.7);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        max-height: 300px;
        overflow-y: auto;
        border: 2px solid #4a3f7d;
      }

      .online-title {
        text-align: center;
        margin-bottom: 15px;
        color: #fad0c4;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .online-title::before {
        content: "üë•";
        margin-right: 10px;
      }

      .players-list {
        list-style: none;
      }

      .player-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        margin-bottom: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        border-left: 3px solid #a1c4fd;
        transition: all 0.3s;
        cursor: pointer;
      }

      .player-item:hover {
        background: rgba(74, 63, 125, 0.3);
      }

      .player-item.me {
        border-left: 3px solid #ff9a9e;
        background: rgba(255, 154, 158, 0.1);
      }

      .player-name {
        font-weight: bold;
        display: flex;
        align-items: center;
      }

      .player-name::before {
        content: "üê±";
        margin-right: 5px;
      }

      .player-resources {
        color: #ff9a9e;
        display: flex;
        align-items: center;
      }

      .player-resources::before {
        content: "üêü";
        margin-right: 5px;
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: rgba(161, 196, 253, 0.9);
        color: #0a0e2a;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transform: translateX(150%);
        transition: transform 0.3s;
        z-index: 1000;
        font-weight: bold;
        border-left: 4px solid #ff9a9e;
      }

      .notification.show {
        transform: translateX(0);
      }

      .boost-indicator {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 50, 50, 0.8);
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        animation: pulse 1s infinite;
        display: flex;
        align-items: center;
      }

      .boost-indicator::before {
        content: "‚ö°";
        margin-right: 5px;
      }

      @keyframes pulse {
        0% {
          opacity: 0.7;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0.7;
        }
      }

      .connection-status {
        position: fixed;
        top: 10px;
        left: 10px;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        z-index: 1000;
        display: flex;
        align-items: center;
      }

      .connection-status::before {
        content: "üåê";
        margin-right: 5px;
      }

      .connected {
        background: rgba(0, 200, 0, 0.8);
      }

      .disconnected {
        background: rgba(200, 0, 0, 0.8);
      }

      .cat-fact {
        background: rgba(161, 196, 253, 0.2);
        padding: 10px;
        border-radius: 8px;
        margin-top: 15px;
        font-size: 0.8rem;
        border-left: 3px solid #ff9a9e;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —á–∞—Ç–∞ */
      .chat-container {
        background: rgba(10, 14, 42, 0.7);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        max-height: 300px;
        display: flex;
        flex-direction: column;
        border: 2px solid #4a3f7d;
      }

      .chat-title {
        text-align: center;
        margin-bottom: 15px;
        color: #fad0c4;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .chat-title::before {
        content: "üí¨";
        margin-right: 10px;
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 15px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        max-height: 150px;
      }

      .message {
        margin-bottom: 10px;
        padding: 8px;
        border-radius: 5px;
        background: rgba(74, 63, 125, 0.3);
        word-wrap: break-word;
      }

      .message.system {
        background: rgba(255, 154, 158, 0.2);
        font-style: italic;
        text-align: center;
      }

      .message.own {
        background: rgba(161, 196, 253, 0.3);
      }

      .message-sender {
        font-weight: bold;
        color: #fad0c4;
      }

      .chat-input-container {
        display: flex;
        gap: 10px;
      }

      .chat-input {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #4a3f7d;
        background: rgba(0, 0, 0, 0.3);
        color: white;
      }

      .chat-send {
        padding: 10px 15px;
        border-radius: 5px;
        border: none;
        background: #4a3f7d;
        color: white;
        cursor: pointer;
        transition: background 0.3s;
      }

      .chat-send:hover {
        background: #5a4f8d;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è –±–∞—Ç—Ç–ª–æ–≤ */
      .battle-container {
        background: rgba(10, 14, 42, 0.7);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 2px solid #4a3f7d;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 400px;
      }

      .battle-title {
        text-align: center;
        margin-bottom: 15px;
        color: #fad0c4;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .battle-title::before {
        content: "‚öîÔ∏è";
        margin-right: 10px;
      }

      .battle-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .battle-btn {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: none;
        background: #4a3f7d;
        color: white;
        cursor: pointer;
        transition: background 0.3s;
        text-align: center;
      }

      .battle-btn:hover {
        background: #5a4f8d;
      }

      .battle-btn:disabled {
        background: #3a3f5d;
        cursor: not-allowed;
      }

      .battle-log {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        font-size: 0.9rem;
        min-height: 150px;
      }

      .battle-event {
        margin-bottom: 5px;
        padding: 5px;
        border-radius: 3px;
        background: rgba(74, 63, 125, 0.3);
      }

      .battle-event.attack {
        background: rgba(255, 100, 100, 0.3);
      }

      .battle-event.defense {
        background: rgba(100, 100, 255, 0.3);
      }

      .battle-event.special {
        background: rgba(255, 200, 100, 0.3);
      }

      .battle-stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }

      .battle-stat {
        text-align: center;
        flex: 1;
      }

      .battle-health {
        height: 10px;
        background: #333;
        border-radius: 5px;
        margin-top: 5px;
        overflow: hidden;
      }

      .battle-health-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff5e5e, #ff9a9e);
        border-radius: 5px;
        transition: width 0.3s;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫–∏–Ω–æ–≤ */
      .skins-container {
        background: rgba(10, 14, 42, 0.7);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        margin-top: 20px;
        border: 2px solid #4a3f7d;
      }

      .skins-title {
        text-align: center;
        margin-bottom: 15px;
        color: #fad0c4;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .skins-title::before {
        content: "üé®";
        margin-right: 10px;
      }

      .skins-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .skin-card {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid #4a3f7d;
        position: relative;
        overflow: hidden;
      }

      .skin-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .skin-card.selected {
        border-color: #ff9a9e;
        background: rgba(255, 154, 158, 0.1);
      }

      .skin-card.owned:not(.selected):hover {
        border-color: #a1c4fd;
      }

      .skin-card.locked {
        cursor: not-allowed;
        opacity: 0.6;
      }

      .skin-card.locked:hover {
        transform: none;
        box-shadow: none;
      }

      .skin-preview {
        width: 80px;
        height: 80px;
        margin: 0 auto 10px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        border-radius: 10px;
      }

      .skin-name {
        font-weight: bold;
        margin-bottom: 5px;
        color: #fad0c4;
      }

      .skin-description {
        font-size: 0.7rem;
        margin-bottom: 10px;
        color: #a1c4fd;
        min-height: 30px;
      }

      .skin-cost {
        color: #ff9a9e;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .skin-cost::before {
        content: "üêü";
        margin-right: 5px;
      }

      .skin-owned {
        color: #a1c4fd;
        font-size: 0.7rem;
        margin-top: 5px;
      }

      .skin-locked {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.8);
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.7rem;
        color: #ff9a9e;
      }

      @media (max-width: 768px) {
        .game-area {
          flex-direction: column;
        }

        .right-column {
          flex: 1;
          width: 100%;
        }

        h1 {
          font-size: 2rem;
        }

        .player-info {
          flex-direction: column;
          gap: 10px;
        }

        .battle-actions {
          flex-direction: column;
        }

        .skins-grid {
          grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }
      }

      .audio-controls {
        /* position: fixed;
        bottom: 20px;
        left: 20px; */
        display: flex;
      }

      .audio-btn {
        background: rgba(74, 63, 125, 0.8);
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        transition: all 0.3s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }

      .audio-btn:hover {
        background: rgba(90, 79, 141, 0.9);
        transform: scale(1.1);
      }

      .audio-btn.muted {
        background: rgba(255, 100, 100, 0.8);
      }

      .volume-slider {
        width: 100px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        padding: 5px;
      }

      .audio-panel {
        background: rgba(10, 14, 42, 0.9);
        border-radius: 15px;
        padding: 15px;
        border: 2px solid #4a3f7d;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      }

      @media (max-width: 768px) {
        .audio-controls {
          bottom: 10px;
          left: 10px;
          flex-direction: column;
        }

        .audio-panel {
          padding: 10px;
        }
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–ª–∏–∫–∞ */
      .click-effect {
        position: absolute;
        font-family: "Press Start 2P", cursive;
        font-size: 1rem;
        color: #ff9a9e;
        text-shadow: 0 0 5px rgba(255, 154, 158, 0.7);
        pointer-events: none;
        z-index: 100;
        animation: floatUp 1s ease-out forwards;
      }

      @keyframes floatUp {
        0% {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
        100% {
          transform: translateY(-50px) scale(1.2);
          opacity: 0;
        }
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π */
      .upgrade-name {
        font-weight: bold;
        margin-bottom: 5px;
        color: #fad0c4;
        font-size: 0.9rem;
      }

      .upgrade-btn {
        width: 100%;
        padding: 8px;
        border: none;
        border-radius: 5px;
        background: linear-gradient(135deg, #4a3f7d, #5a4f8d);
        color: white;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 5px;
        font-size: 0.8rem;
      }

      .upgrade-btn:hover:not(:disabled) {
        background: linear-gradient(135deg, #5a4f8d, #6a5f9d);
        transform: translateY(-2px);
      }

      .upgrade-btn:disabled {
        background: linear-gradient(135deg, #3a3f5d, #4a4f6d);
        cursor: not-allowed;
        opacity: 0.7;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫–∏–Ω–æ–≤ */
      .skin {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid #4a3f7d;
        position: relative;
        overflow: hidden;
      }

      .skin:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .skin.owned {
        border-color: #a1c4fd;
      }

      .skin.active {
        border-color: #ff9a9e;
        background: rgba(255, 154, 158, 0.1);
      }

      .skin.locked {
        cursor: not-allowed;
        opacity: 0.6;
      }

      .skin.locked:hover {
        transform: none;
        box-shadow: none;
      }

      .skin-preview {
        width: 80px;
        height: 80px;
        margin: 0 auto 10px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        border-radius: 10px;
        font-size: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .skin-name {
        font-weight: bold;
        margin-bottom: 5px;
        color: #fad0c4;
        font-size: 0.9rem;
      }

      .skin-description {
        font-size: 0.7rem;
        margin-bottom: 10px;
        color: #a1c4fd;
        min-height: 30px;
      }

      .skin-cost {
        color: #ff9a9e;
        font-size: 0.8rem;
        margin-bottom: 5px;
      }

      .skin-bonus {
        color: #a1c4fd;
        font-size: 0.7rem;
        margin-bottom: 10px;
      }

      .skin-btn {
        width: 100%;
        padding: 6px;
        border: none;
        border-radius: 5px;
        background: linear-gradient(135deg, #4a3f7d, #5a4f8d);
        color: white;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.7rem;
      }

      .skin-btn:hover:not(:disabled) {
        background: linear-gradient(135deg, #5a4f8d, #6a5f9d);
      }

      .skin-btn:disabled {
        background: linear-gradient(135deg, #3a3f5d, #4a4f6d);
        cursor: not-allowed;
        opacity: 0.7;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–≤–µ—Ä–ª–µ—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ */
      .audio-init-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0a0e2a, #1a1f4b, #2d2366);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        color: white;
        text-align: center;
        padding: 20px;
      }

      .audio-init-title {
        font-size: 2rem;
        margin-bottom: 20px;
        background: linear-gradient(90deg, #ff9a9e, #fad0c4, #a1c4fd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 10px rgba(255, 154, 158, 0.5);
      }

      .audio-init-btn {
        padding: 15px 30px;
        margin: 10px;
        border: none;
        border-radius: 10px;
        background: linear-gradient(135deg, #4a3f7d, #5a4f8d);
        color: white;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s;
        width: 300px;
        max-width: 90%;
      }

      .audio-init-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      .audio-init-option {
        margin-top: 20px;
        color: #a1c4fd;
        font-style: italic;
      }

      .audio-label {
        text-align: center;
        margin-bottom: 10px;
        color: #fad0c4;
        font-size: 0.9rem;
      }

      /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: rgba(161, 196, 253, 0.9);
        color: #0a0e2a;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transform: translateX(150%);
        transition: all 0.5s ease-in-out;
        z-index: 1000;
        font-weight: bold;
        border-left: 4px solid #ff9a9e;
        max-width: 300px;
      }

      .notification.show {
        transform: translateX(0);
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
      @media (max-width: 480px) {
        .skin-preview {
          width: 60px;
          height: 60px;
          font-size: 2rem;
        }

        .skin-name {
          font-size: 0.8rem;
        }

        .skin-description {
          font-size: 0.6rem;
        }

        .upgrade-name {
          font-size: 0.8rem;
        }

        .audio-init-title {
          font-size: 1.5rem;
        }

        .audio-init-btn {
          font-size: 1rem;
          padding: 12px 20px;
        }
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–æ–≤ */
      .chat-messages::-webkit-scrollbar,
      .battle-log::-webkit-scrollbar,
      .online-players::-webkit-scrollbar {
        width: 6px;
      }

      .chat-messages::-webkit-scrollbar-track,
      .battle-log::-webkit-scrollbar-track,
      .online-players::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
      }

      .chat-messages::-webkit-scrollbar-thumb,
      .battle-log::-webkit-scrollbar-thumb,
      .online-players::-webkit-scrollbar-thumb {
        background: #4a3f7d;
        border-radius: 3px;
      }

      .chat-messages::-webkit-scrollbar-thumb:hover,
      .battle-log::-webkit-scrollbar-thumb:hover,
      .online-players::-webkit-scrollbar-thumb:hover {
        background: #5a4f8d;
      }

      .player-item.selected {
        border-left: 3px solid #ff9a9e !important;
        background: rgba(255, 154, 158, 0.2) !important;
        transform: scale(1.02);
        transition: all 0.3s ease;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è –∞—É–¥–∏–æ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–ª–æ–∫–µ */
      .audio-controls-main {
        margin: 15px 0;
        display: flex;
        justify-content: center;
      }

      .audio-controls-main .audio-panel {
        background: rgba(10, 14, 42, 0.9);
        border-radius: 15px;
        padding: 15px;
        border: 2px solid #4a3f7d;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .audio-controls-main .audio-label {
        margin-bottom: 0;
        margin-right: 10px;
      }

      /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–≥—Ä–æ–∫–æ–≤ */
      .player-item {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        margin-bottom: 8px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        border-left: 3px solid #a1c4fd;
        transition: all 0.3s;
        cursor: pointer;
      }

      .player-item:hover {
        background: rgba(74, 63, 125, 0.3);
        transform: translateY(-2px);
      }

      .player-item.selected {
        border-left: 3px solid #ff9a9e !important;
        background: rgba(255, 154, 158, 0.2) !important;
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(255, 154, 158, 0.3);
      }

      .player-item.me {
        border-left: 3px solid #ff9a9e;
        background: rgba(255, 154, 158, 0.1);
      }

      .player-item.me.selected {
        border-left: 3px solid #ff9a9e !important;
        background: rgba(255, 154, 158, 0.25) !important;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π */
      .upgrade {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        border: 1px solid #4a3f7d;
        position: relative;
        overflow: hidden;
      }

      .upgrade:hover {
        background: rgba(74, 63, 125, 0.3);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .upgrade.disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .upgrade.disabled:hover {
        transform: none;
        background: rgba(0, 0, 0, 0.3);
      }

      .upgrade-btn {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 5px;
        background: linear-gradient(135deg, #4a3f7d, #5a4f8d);
        color: white;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 8px;
        font-size: 0.9rem;
        font-weight: bold;
      }

      .upgrade-btn:hover:not(:disabled) {
        background: linear-gradient(135deg, #5a4f8d, #6a5f9d);
        transform: translateY(-2px);
      }

      .upgrade-btn:disabled {
        background: linear-gradient(135deg, #3a3f5d, #4a4f6d);
        cursor: not-allowed;
        opacity: 0.7;
      }

      @media (max-width: 768px) {
        .audio-controls-main .audio-panel {
          flex-direction: column;
          gap: 10px;
        }

        .audio-controls-main .audio-label {
          margin-right: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="audio-init-overlay" id="audioInitOverlay">
      <h2 class="audio-init-title">üéµ –ö–û–°–ú–ò–ß–ï–°–ö–ê–Ø –ú–£–ó–´–ö–ê üéµ</h2>
      <p style="margin-bottom: 30px; font-size: 1.1rem; color: #fad0c4">
        –î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –º—É–∑—ã–∫–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–ª–∏–∫ –ø–æ –∏–≥—Ä–æ–≤–æ–º—É –ø–æ–ª—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
      </p>

      <button class="audio-init-btn" id="enableAudioBtn">
        üéµ –†–ê–ó–†–ï–®–ò–¢–¨ –ú–£–ó–´–ö–£ –ò –ó–í–£–ö–ò
      </button>

      <button
        class="audio-init-btn"
        id="disableAudioBtn"
        style="background: linear-gradient(135deg, #666, #999)"
      >
        üîá –ò–ì–†–ê–¢–¨ –ë–ï–ó –ó–í–£–ö–ê
      </button>

      <div class="audio-init-option">
        –ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∫–æ—Å–∞—Ç–∫–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º—É–∑—ã–∫–∏
      </div>
    </div>

    <div class="connection-status disconnected" id="connectionStatus">
      –û—Ç–∫–ª—é—á–µ–Ω
    </div>

    <div class="container">
      <header>
        <h1>–ö–æ—Å–∞—Ç–∫–∞ –ö–ª–∏–∫: –ö–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</h1>
        <p class="subtitle">
          –ü–æ–º–æ–≥–∏ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π –∫–æ—à–∫–µ –ö–æ—Å–∞—Ç–∫–µ —Å–æ–±—Ä–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ —Ä—ã–±–æ–∫!
        </p>
      </header>
      <!-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ game-area -->
      <div class="game-area">
        <div class="main-game">
          <div class="player-info">
            <div class="resource">
              <div class="resource-label">–†—ã–±–∫–∏</div>
              <div class="resource-value" id="resources">0</div>
            </div>
            <div class="resource">
              <div class="resource-label">–†—ã–±–æ–∫/–∫–ª–∏–∫</div>
              <div class="resource-value" id="click-power">1</div>
            </div>
            <div class="resource">
              <div class="resource-label">–†—ã–±–æ–∫/—Å–µ–∫</div>
              <div class="resource-value" id="auto-power">0</div>
            </div>
          </div>

          <div class="kosatka-area" id="kosatka">
            <div class="kosatka-img">
              <img src="cat.png" alt="–ö–æ—Å–∞—Ç–∫–∞" id="kosatka-skin" />
            </div>
            <div
              class="boost-indicator"
              id="boost-indicator"
              style="display: none"
            >
              –ë–£–°–¢ x2!
            </div>
          </div>

          <!-- –ß–∞—Ç –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω —Å—é–¥–∞ -->
          <div class="chat-container">
            <h2 class="chat-title">–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ß–∞—Ç</h2>
            <div class="chat-messages" id="chat-messages">
              <div class="message system">
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π —á–∞—Ç!
              </div>
            </div>
            <div class="chat-input-container">
              <input
                type="text"
                class="chat-input"
                id="chat-input"
                placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                maxlength="200"
              />
              <button class="chat-send" id="chat-send">–û—Ç–ø—Ä.</button>
            </div>
          </div>

          <h2 style="color: #fad0c4; margin-bottom: 10px">
            –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ö–æ—Å–∞—Ç–∫–∏
          </h2>
          <div class="upgrades" id="upgrades">
            <!-- –£–ª—É—á—à–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
          </div>

          <div class="skins-container">
            <h2 class="skins-title">–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –°–∫–∏–Ω—ã</h2>
            <div class="skins-grid" id="skins-grid">
              <!-- –°–∫–∏–Ω—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
          </div>

          <div class="cat-fact">
            <strong>–§–∞–∫—Ç –æ –∫–æ—à–∫–∞—Ö:</strong> –ö–æ—à–∫–∞ –ö–æ—Å–∞—Ç–∫–∞ –ø–æ–ª—É—á–∏–ª–∞ —Å–≤–æ—ë –∏–º—è –∑–∞
            –ª—é–±–æ–≤—å –∫ —Ä—ã–±–∫–µ –∏ –∫–æ—Å–º–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º!
          </div>
        </div>

        <div class="right-column">
          <!-- –û–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–∏ -->
          <div class="online-players">
            <h2 class="online-title">–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –∫–æ—Ç—ã –æ–Ω–ª–∞–π–Ω</h2>
            <ul class="players-list" id="players-list">
              <li class="player-item">
                <span class="player-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                <span class="player-resources">0</span>
              </li>
            </ul>

            <div class="cat-fact">
              <strong>–°–æ–≤–µ—Ç:</strong> –û–±—â–∞–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ—Å–º–∏—á–µ—Å–∫–∏–º–∏ –∫–æ—Ç–∞–º–∏ –∏
              —Å–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å –∑–∞ –∑–≤–∞–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Ä—ã–±–æ–ª–æ–≤–∞!
            </div>
          </div>

          <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ -->
          <div class="online-players" style="margin-top: 15px;">
            <h2 class="online-title">–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
            <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
              <input id="custom-nick" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" style="flex:1; padding:6px; border-radius:6px; background:rgba(0,0,0,0.15); border:1px solid #4a3f7d; color:#fff;" />
              <button id="save-nick" class="upgrade-btn small">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
            <ol id="leaderboard-list" style="padding-left: 18px; margin-top: 10px;">
              <li>–ó–∞–≥—Ä—É–∑–∫–∞...</li>
            </ol>
            <div style="text-align:center; margin-top:8px;"><button id="refresh-leaderboard" class="upgrade-btn">–û–±–Ω–æ–≤–∏—Ç—å</button></div>
          </div>

          <!-- –ö–ª–∞–Ω—ã -->
          <div class="online-players" style="margin-top: 15px;">
            <h2 class="online-title">–ö–ª–∞–Ω—ã</h2>
            <div style="margin-bottom:8px; display:flex; gap:6px;">
              <input id="new-clan-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞" style="flex:1; padding:6px; border-radius:6px; background:rgba(0,0,0,0.3); border:1px solid #4a3f7d; color:#fff;" />
              <button id="create-clan" class="upgrade-btn">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
            <div id="clans-list">
              –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞–Ω–æ–≤...
            </div>
          </div>

          <!-- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è -->
          <div class="online-players" style="margin-top: 15px;">
            <h2 class="online-title">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h2>
            <div id="tasks-list">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...</div>
          </div>

          <!-- –ë–∞—Ç—Ç–ª—ã -->
          <div class="battle-container">
            <h2 class="battle-title">–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –ë–∞—Ç–ª—ã</h2>
            <div class="battle-stats">
              <div class="battle-stat">
                <div>–í–∞—à–µ –∑–¥–æ—Ä–æ–≤—å–µ</div>
                <div id="player-health">100/100</div>
                <div class="battle-health">
                  <div
                    class="battle-health-fill"
                    id="player-health-bar"
                    style="width: 100%"
                  ></div>
                </div>
              </div>
              <div class="battle-stat">
                <div>–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</div>
                <div id="opponent-health">100/100</div>
                <div class="battle-health">
                  <div
                    class="battle-health-fill"
                    id="opponent-health-bar"
                    style="width: 100%"
                  ></div>
                </div>
              </div>
            </div>
            <div class="battle-actions" id="battle-actions">
              <button class="battle-btn" id="attack-btn">
                –ê—Ç–∞–∫–∞ (10 —Ä—ã–±–æ–∫)
              </button>
              <button class="battle-btn" id="special-btn">
                –°—É–ø–µ—Ä-—É–¥–∞—Ä (25 —Ä—ã–±–æ–∫)
              </button>
              <button class="battle-btn" id="challenge-btn">
                –í—ã–∑–≤–∞—Ç—å –Ω–∞ –±–æ–π
              </button>
            </div>
            <div class="battle-log" id="battle-log">
              <div class="battle-event system">
                –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –Ω–∞—á–Ω–∏—Ç–µ –±–∏—Ç–≤—É!
              </div>
            </div>

            <div
              class="audio-controls-main"
              id="audioControls"
              style="display: none"
            >
              <div class="audio-panel">
                <div class="audio-label">–ó–í–£–ö</div>
                <button class="audio-btn" id="music-toggle" title="–ú—É–∑—ã–∫–∞">
                  üéµ
                </button>
                <button class="audio-btn" id="sfx-toggle" title="–ó–≤—É–∫–∏">
                  üîä
                </button>
                <input
                  type="range"
                  
                  min="0"
                  max="100"
                  value="50"
                  class="volume-slider"
                  id="volume-slider"
                  title="–ì—Ä–æ–º–∫–æ—Å—Ç—å"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="notification" id="notification">
      –ù–æ–≤—ã–π –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∏–≥—Ä–µ!
    </div>

    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ -->
    <audio id="background-music" loop preload="auto">
      <source src="background-music.mp3" type="audio/mpeg" />
      <source src="background-music.ogg" type="audio/ogg" />
      –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã.
    </audio>

    <audio id="click-sound" preload="auto">
      <source src="click.mp3" type="audio/mpeg" />
      <source src="click.ogg" type="audio/ogg" />
    </audio>

    <audio id="upgrade-sound" preload="auto">
      <source src="upgrade.mp3" type="audio/mpeg" />
      <source src="upgrade.ogg" type="audio/ogg" />
    </audio>

    <audio id="battle-sound" preload="auto">
      <source src="battle.mp3" type="audio/mpeg" />
      <source src="sounds/battle.ogg" type="audio/ogg" />
    </audio>

    <audio id="victory-sound" preload="auto">
      <source src="victory.mp3" type="audio/mpeg" />
      <source src="victory.ogg" type="audio/ogg" />
    </audio>

    <audio id="notification-sound" preload="auto">
      <source src="notification.mp3" type="audio/mpeg" />
      <source src="notification.ogg" type="audio/ogg" />
    </audio>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      let resources = 0;
      let clickPower = 1;
      let autoPower = 0;
      let boostActive = false;
      let boostTimeLeft = 0;
      // Stable player name: read from localStorage if present, otherwise generate once and persist
      let playerName = (function () {
        try {
          const saved = localStorage.getItem('kosatkaClicker');
          if (saved) {
            const gd = JSON.parse(saved);
            if (gd && gd.playerName) return gd.playerName;
          }
        } catch (e) {
          // ignore
        }
        const baseNames = ['–ö–æ—Ç', '–ö–æ—Å–∞—Ç–∫–∞', '–ö–∏—Ç', '–î–µ–ª—å—Ñ–∏–Ω', '–ú–æ—Ä—è–∫'];
        const name = baseNames[Math.floor(Math.random() * baseNames.length)] + '_' + (100 + Math.floor(Math.random() * 900));
        try {
          const obj = JSON.parse(localStorage.getItem('kosatkaClicker') || '{}');
          obj.playerName = name;
          localStorage.setItem('kosatkaClicker', JSON.stringify(obj));
        } catch (e) {
          // ignore
        }
        return name;
      })();
      let socket = null;
      let selectedOpponent = null;
      let inBattle = false;
      let battleLog = [];
      let currentBattleId = null;
      let playerHealth = 100;
      let opponentHealth = 100;
      let currentSkin = "default";
      let ownedSkins = ["default"];
      let currentPlayerId = null;
      let gameInitialized = false;

      // –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –°–ö–ò–ù–´ –î–õ–Ø –ö–û–°–ê–¢–ö–ò
      const skins = [
        {
          id: "cat",
          name: "–û–±—ã—á–Ω–∞—è –ö–æ—Å–∞—Ç–∫–∞",
          description: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ç",
          cost: 0,
          bonus: 0,
          owned: true,
          preview: "üê±",
        },
        {
          id: "skin3",
          name: "–†—ã–±–Ω—ã–π –ì—É—Ä–º–∞–Ω",
          description: "–ö–æ—Å–∞—Ç–∫–∞ –±–∞–ª–¥–µ–µ—Ç –æ—Ç —Ä—ã–±—ã",
          cost: 750,
          bonus: 8,
          owned: false,
          preview: "üòª",
        },
        {
          id: "skin4",
          name: "–ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å",
          description: "–õ—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ –≥–∞–ª–∞–∫—Ç–∏–∫–∏",
          cost: 1500,
          bonus: 12,
          owned: false,
          preview: "üî≠",
        },
        {
          id: "skin5",
          name: "–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –ö–æ—Å–º–æ–Ω–∞–≤—Ç",
          description: "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –∑–∞—Ä—è–¥–∫–∞",
          cost: 2500,
          bonus: 18,
          owned: false,
          preview: "‚ö°",
        },
        {
          id: "skin6",
          name: "–¢—é–±–∏—á–Ω—ã–π –†—ã–±–æ–ª–æ–≤",
          description: "–†—ã–±–∞ –∏–∑ —Ç—é–±–∏–∫–∞",
          cost: 4000,
          bonus: 22,
          owned: false,
          preview: "üß¥",
        },
        {
          id: "skin7",
          name: "–í—Å–µ–ª–µ–Ω—Å–∫–∏–π –ü—Ä–æ–≤–∏–¥–µ—Ü",
          description: "–í–∑–≥–ª—è–¥ —Å–∫–≤–æ–∑—å –≤—Å–µ–ª–µ–Ω–Ω—É—é",
          cost: 6000,
          bonus: 30,
          owned: false,
          preview: "üëÅÔ∏è",
        },
      ];

      // –£–ª—É—á—à–µ–Ω–∏—è —Å –∫–æ—à–∞—á—å–µ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π
      const upgrades = [
        {
          id: 1,
          name: "–£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–æ–≥—Ç–∏",
          description: "–ö–æ—Å–∞—Ç–∫–∞ –ª–æ–≤–∏—Ç –±–æ–ª—å—à–µ —Ä—ã–±–æ–∫ –∑–∞ –æ–¥–∏–Ω –∫–ª–∏–∫",
          cost: 10,
          power: 1,
          type: "click",
          owned: 0,
        },
        {
          id: 2,
          name: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä—ã–±–∞–ª–∫–∞",
          description: "–ö–æ—Å–∞—Ç–∫–∞ –ª–æ–≤–∏—Ç —Ä—ã–±–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏",
          cost: 50,
          power: 1,
          type: "auto",
          owned: 0,
        },
        {
          id: 3,
          name: "–ö–æ—à–∞—á–∏–π –∞–∑–∞—Ä—Ç",
          description: "–í—Ä–µ–º–µ–Ω–Ω–æ —É–¥–≤–∞–∏–≤–∞–µ—Ç —É–ª–æ–≤ —Ä—ã–±–æ–∫",
          cost: 100,
          power: 0,
          type: "boost",
          owned: 0,
        },
        {
          id: 4,
          name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —É–¥–æ—á–Ω–∏–∫",
          description: "–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —É–ª–æ–≤",
          cost: 500,
          power: 5,
          type: "auto",
          owned: 0,
        },
        {
          id: 5,
          name: "–†—ã–±–Ω—ã–π –º–∞–≥–Ω–∏—Ç",
          description: "–ü—Ä–∏–º–∞–Ω–∏–≤–∞–µ—Ç –≤ 5 —Ä–∞–∑ –±–æ–ª—å—à–µ —Ä—ã–±–æ–∫",
          cost: 1000,
          power: 5,
          type: "click",
          owned: 0,
        },
        {
          id: 6,
          name: "–ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –±—É—Å—Ç–µ—Ä",
          description: "–£–¥–≤–∞–∏–≤–∞–µ—Ç —É–ª–æ–≤ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥",
          cost: 2000,
          power: 0,
          type: "boost",
          owned: 0,
        },
        {
          id: 7,
          name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å",
          description: "–ö–æ—Å–∞—Ç–∫–∞ –º–æ–∂–µ—Ç –ª–æ–≤–∏—Ç—å —Ä—ã–±–æ–∫ –≤ –¥–∞–ª—å–Ω–∏—Ö –≥–∞–ª–∞–∫—Ç–∏–∫–∞—Ö",
          cost: 5000,
          power: 10,
          type: "auto",
          owned: 0,
        },
        {
          id: 8,
          name: "–†—ã–±–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä",
          description: "–ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–µ–¥–∫–∏–µ —Ä—ã–±–∫–∏",
          cost: 10000,
          power: 20,
          type: "click",
          owned: 0,
        },
      ];

      // –°–ª—É—á–∞–π–Ω—ã–µ –∫–æ—à–∞—á—å–∏ —Ñ–∞–∫—Ç—ã
      const catFacts = [
        "–ö–æ—à–∫–∏ —Å–ø—è—Ç –æ–∫–æ–ª–æ 16 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å!",
        "–£ –∫–æ—à–µ–∫ –±–æ–ª–µ–µ 20 –º—ã—à—Ü —É–ø—Ä–∞–≤–ª—è—é—Ç —É—à–∞–º–∏.",
        "–ö–æ—à–∫–∞ –º–æ–∂–µ—Ç –ø—Ä—ã–≥–Ω—É—Ç—å –Ω–∞ –≤—ã—Å–æ—Ç—É –≤ 6 —Ä–∞–∑ –±–æ–ª—å—à–µ –µ—ë —Ä–æ—Å—Ç–∞.",
        "–ö–æ—à–∫–∏ –º–æ–≥—É—Ç –ø–∏—Ç—å –º–æ—Ä—Å–∫—É—é –≤–æ–¥—É –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–≤–æ–∏–º –ø–æ—á–∫–∞–º.",
        "–£—Å—ã –ø–æ–º–æ–≥–∞—é—Ç –∫–æ—à–∫–∞–º –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –ø—Ä–æ–ª–µ–∑—É—Ç –ª–∏ –æ–Ω–∏ –≤ –æ—Ç–≤–µ—Ä—Å—Ç–∏–µ.",
        "–ö–æ—à–∫–∏ –º—è—É–∫–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –ª—é–¥—å–º–∏.",
        "–°–µ—Ä–¥—Ü–µ –∫–æ—à–∫–∏ –±—å–µ—Ç—Å—è –ø–æ—á—Ç–∏ –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ.",
        "–ö–æ—à–∫–∏ –º–æ–≥—É—Ç –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å —É—à–∏ –Ω–∞ 180 –≥—Ä–∞–¥—É—Å–æ–≤.",
      ];

      // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
      let resourcesEl,
        clickPowerEl,
        autoPowerEl,
        kosatkaEl,
        kosatkaSkinEl,
        upgradesEl,
        skinsGridEl;
      let playersListEl, notificationEl, boostIndicatorEl, connectionStatusEl;
      let chatMessagesEl, chatInputEl, chatSendEl, battleActionsEl, battleLogEl;
      let attackBtnEl,
        specialBtnEl,
        challengeBtnEl,
        playerHealthEl,
        opponentHealthEl;
      let playerHealthBarEl, opponentHealthBarEl;

      // –ê—É–¥–∏–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      let musicEnabled = false;
      let sfxEnabled = false;
      let volume = 0.5;
      let audioInitialized = false;
      let userInteracted = false;
      let audioContext = null;
      let isMusicPlaying = false;
      let musicPlayAttempted = false;

      // –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã
      let backgroundMusic,
        clickSound,
        upgradeSound,
        battleSound,
        victorySound,
        notificationSound;
      let musicToggleBtn,
        sfxToggleBtn,
        volumeSlider,
        audioInitOverlay,
        audioControls;
      let enableAudioBtn, disableAudioBtn;

      // ========== –î–û–ë–ê–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      function updateUI() {
        if (resourcesEl) resourcesEl.textContent = formatNumber(resources);
        if (clickPowerEl) clickPowerEl.textContent = formatNumber(clickPower);
        if (autoPowerEl) autoPowerEl.textContent = formatNumber(autoPower);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–∏–Ω–∞
        if (kosatkaSkinEl) {
          kosatkaSkinEl.src =
            currentSkin === "default" ? "cat.png" : `${currentSkin}.png`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π
        updateUpgradesUI();

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–∏–Ω–æ–≤
        updateSkinsUI();

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        saveGame();
      }

      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
      function formatNumber(num) {
        if (num >= 1000000) {
          return (num / 1000000).toFixed(1) + "M";
        } else if (num >= 1000) {
          return (num / 1000).toFixed(1) + "K";
        }
        return num.toString();
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π
      function createUpgrades() {
        if (!upgradesEl) return;

        upgradesEl.innerHTML = "";

        upgrades.forEach((upgrade) => {
          const upgradeEl = document.createElement("div");
          upgradeEl.className = "upgrade";
          upgradeEl.innerHTML = `
      <div class="upgrade-name">${upgrade.name}</div>
      <div class="upgrade-description">${upgrade.description}</div>
      <div class="upgrade-cost">–°—Ç–æ–∏–º–æ—Å—Ç—å: ${formatNumber(
        upgrade.cost
      )} —Ä—ã–±–æ–∫</div>
      <div class="upgrade-owned">–ö—É–ø–ª–µ–Ω–æ: ${upgrade.owned}</div>
      <button class="upgrade-btn" data-id="${upgrade.id}" ${
            resources < upgrade.cost ? "disabled" : ""
          }>
        ${resources < upgrade.cost ? "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä—ã–±–æ–∫" : "–ö—É–ø–∏—Ç—å"}
      </button>
    `;

          upgradesEl.appendChild(upgradeEl);
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π
        document.querySelectorAll(".upgrade-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const upgradeId = parseInt(this.getAttribute("data-id"));
            buyUpgrade(upgradeId);
          });
        });
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —É–ª—É—á—à–µ–Ω–∏–π
      function updateUpgradesUI() {
        document.querySelectorAll(".upgrade").forEach((upgradeEl, index) => {
          const upgrade = upgrades[index];
          if (upgrade) {
            const costEl = upgradeEl.querySelector(".upgrade-cost");
            const ownedEl = upgradeEl.querySelector(".upgrade-owned");
            const btn = upgradeEl.querySelector(".upgrade-btn");

            if (costEl)
              costEl.textContent = `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${formatNumber(
                upgrade.cost
              )} —Ä—ã–±–æ–∫`;
            if (ownedEl) ownedEl.textContent = `–ö—É–ø–ª–µ–Ω–æ: ${upgrade.owned}`;
            if (btn) {
              btn.disabled = resources < upgrade.cost;
              btn.textContent =
                resources < upgrade.cost ? "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä—ã–±–æ–∫" : "–ö—É–ø–∏—Ç—å";
            }
          }
        });
      }

      // –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è
      function buyUpgrade(upgradeId) {
        const upgrade = upgrades.find((u) => u.id === upgradeId);
        if (!upgrade || resources < upgrade.cost) {
          showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä—ã–±–æ–∫ –¥–ª—è –ø–æ–∫—É–ø–∫–∏!");
          return;
        }

        resources -= upgrade.cost;

        if (upgrade.type === "click") {
          clickPower += upgrade.power;
          showNotification(
            `–£–ª—É—á—à–µ–Ω–∞ —Å–∏–ª–∞ –∫–ª–∏–∫–∞! +${upgrade.power} —Ä—ã–±–æ–∫ –∑–∞ –∫–ª–∏–∫`
          );
        } else if (upgrade.type === "auto") {
          autoPower += upgrade.power;
          showNotification(
            `–£–ª—É—á—à–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–±—ã—á–∞! +${upgrade.power} —Ä—ã–±–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É`
          );
        } else if (upgrade.type === "boost") {
          activateBoost(upgrade.id);
        }

        upgrade.owned++;
        upgrade.cost = Math.floor(upgrade.cost * 1.5); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å

        playSound(upgradeSound);
        updateUI();
        saveGame();
      }

      // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –±—É—Å—Ç–∞
      function activateBoost(upgradeId) {
        if (boostActive) {
          showNotification("–ë—É—Å—Ç —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω!");
          return;
        }

        boostActive = true;
        boostTimeLeft = upgradeId === 3 ? 10 : 30; // 10 –∏–ª–∏ 30 —Å–µ–∫—É–Ω–¥

        if (boostIndicatorEl) {
          boostIndicatorEl.style.display = "block";
        }

        showNotification(
          "–ë—É—Å—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –£–ª–æ–≤ —É–¥–≤–æ–µ–Ω –Ω–∞ " + boostTimeLeft + " —Å–µ–∫—É–Ω–¥!"
        );

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –±—É—Å—Ç–∞
        const boostInterval = setInterval(() => {
          boostTimeLeft--;

          if (boostTimeLeft <= 0) {
            boostActive = false;
            if (boostIndicatorEl) {
              boostIndicatorEl.style.display = "none";
            }
            showNotification("–ë—É—Å—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è!");
            clearInterval(boostInterval);
          }
        }, 1000);
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫–∏–Ω–æ–≤
      function createSkins() {
        if (!skinsGridEl) return;

        skinsGridEl.innerHTML = "";

        skins.forEach((skin) => {
          const skinEl = document.createElement("div");
          skinEl.className = `skin ${skin.owned ? "owned" : "locked"} ${
            currentSkin === skin.id ? "active" : ""
          }`;
          skinEl.innerHTML = `
            <div class="skin-preview">${skin.preview}</div>
            <div class="skin-name">${skin.name}</div>
            <div class="skin-description">${skin.description}</div>
            <div class="skin-cost">${
              skin.owned ? "–ö—É–ø–ª–µ–Ω" : `${formatNumber(skin.cost)} —Ä—ã–±–æ–∫`
            }</div>
            <div class="skin-bonus">–ë–æ–Ω—É—Å: +${skin.bonus}%</div>
            <button class="skin-btn" data-id="${skin.id}" ${
            !skin.owned && resources < skin.cost ? "disabled" : ""
          }>
              ${
                currentSkin === skin.id
                  ? "–í—ã–±—Ä–∞–Ω"
                  : skin.owned
                  ? "–í—ã–±—Ä–∞—Ç—å"
                  : "–ö—É–ø–∏—Ç—å"
              }
            </button>
          `;

          skinsGridEl.appendChild(skinEl);
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–∫–∏–Ω–æ–≤
        document.querySelectorAll(".skin-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const skinId = this.getAttribute("data-id");
            handleSkinClick(skinId);
          });
        });
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å–∫–∏–Ω–æ–≤
      function updateSkinsUI() {
        document.querySelectorAll(".skin").forEach((skinEl, index) => {
          const skin = skins[index];
          if (skin) {
            const costEl = skinEl.querySelector(".skin-cost");
            const btn = skinEl.querySelector(".skin-btn");

            skinEl.className = `skin ${skin.owned ? "owned" : "locked"} ${
              currentSkin === skin.id ? "active" : ""
            }`;

            if (costEl) {
              costEl.textContent = skin.owned
                ? "–ö—É–ø–ª–µ–Ω"
                : `${formatNumber(skin.cost)} —Ä—ã–±–æ–∫`;
            }

            if (btn) {
              btn.disabled = !skin.owned && resources < skin.cost;
              btn.textContent =
                currentSkin === skin.id
                  ? "–í—ã–±—Ä–∞–Ω"
                  : skin.owned
                  ? "–í—ã–±—Ä–∞—Ç—å"
                  : "–ö—É–ø–∏—Ç—å";
            }
          }
        });
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —Å–∫–∏–Ω—É
      function handleSkinClick(skinId) {
        const skin = skins.find((s) => s.id === skinId);
        if (!skin) return;

        if (skin.owned) {
          currentSkin = skinId;
          showNotification(`–°–∫–∏–Ω "${skin.name}" –≤—ã–±—Ä–∞–Ω!`);
        } else if (resources >= skin.cost) {
          resources -= skin.cost;
          skin.owned = true;
          ownedSkins.push(skinId);
          currentSkin = skinId;
          showNotification(`–°–∫–∏–Ω "${skin.name}" –∫—É–ø–ª–µ–Ω –∏ –≤—ã–±—Ä–∞–Ω!`);
        }

        updateUI();
        saveGame();
      }

      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
      function sendChatMessage() {
          if (!chatInputEl || !socket) return;
          
          const message = chatInputEl.value.trim();
          if (message === '') return;
          
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
          socket.emit('chat-message', {
              message: message,
              timestamp: new Date().toLocaleTimeString()
          });
          
          // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
          chatInputEl.value = '';
      }

      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
      function addChatMessage(playerName, message, timestamp) {
          if (!chatMessagesEl) return;
          
          const messageEl = document.createElement('div');
          const isOwnMessage = playerName === '–í—ã' || playerName === playerName;
          
          messageEl.className = `message ${isOwnMessage ? 'own' : ''} ${playerName === '–°–∏—Å—Ç–µ–º–∞' ? 'system' : ''}`;
          
          if (playerName !== '–°–∏—Å—Ç–µ–º–∞') {
              messageEl.innerHTML = `
                  <div class="message-sender">${playerName}:</div>
                  <div class="message-text">${message}</div>
                  <div class="message-time">${timestamp}</div>
              `;
          } else {
              messageEl.innerHTML = `
                  <div class="message-text">${message}</div>
                  <div class="message-time">${timestamp}</div>
              `;
          }
          
          chatMessagesEl.appendChild(messageEl);
          
          // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —á–∞—Ç –≤–Ω–∏–∑
          chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
          
          // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —á—É–∂–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
          if (!isOwnMessage && playerName !== '–°–∏—Å—Ç–µ–º–∞') {
              playSound(notificationSound);
          }
      }

      // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
      function gameLoop() {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤
        if (autoPower > 0) {
          const baseGain = autoPower;
          const gain = boostActive ? baseGain * 2 : baseGain;
          resources += gain;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±—É—Å—Ç–∞
        if (boostActive) {
          boostTimeLeft--;
          if (boostTimeLeft <= 0) {
            boostActive = false;
            if (boostIndicatorEl) {
              boostIndicatorEl.style.display = "none";
            }
            showNotification("–ë—É—Å—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è!");
          }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        updateUI();

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        if (socket && socket.connected) {
          socket.emit("player-update", {
            name: playerName,
            resources: resources,
            clickPower: clickPower,
            autoPower: autoPower,
            currentSkin: currentSkin,
            ownedSkins: ownedSkins,
          });
        }
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–æ—Å–∞—Ç–∫–µ
      function clickKosatka(event) {
        const baseGain = clickPower;
        const gain = boostActive ? baseGain * 2 : baseGain;
        resources += gain;

        // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü
        createClickEffect(event);

        playSound(clickSound);
        updateUI();
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ
      function createClickEffect(event) {
        const effect = document.createElement("div");
        effect.className = "click-effect";
        effect.textContent = `+${formatNumber(
          boostActive ? clickPower * 2 : clickPower
        )}`;
        effect.style.left = event.clientX - 20 + "px";
        effect.style.top = event.clientY - 20 + "px";

        document.body.appendChild(effect);

        setTimeout(() => {
          effect.remove();
        }, 1000);
      }

      // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      function showNotification(message) {
        if (!notificationEl) return;

        notificationEl.textContent = message;
        notificationEl.style.display = "block";
        notificationEl.style.opacity = "1";

        playSound(notificationSound);

        setTimeout(() => {
          notificationEl.style.opacity = "0";
          setTimeout(() => {
            notificationEl.style.display = "none";
          }, 500);
        }, 3000);
      }

      // –ü–æ–∫–∞–∑ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ñ–∞–∫—Ç–∞ –æ –∫–æ—à–∫–∞—Ö
      function showRandomCatFact() {
        const randomFact =
          catFacts[Math.floor(Math.random() * catFacts.length)];
        const factElement = document.querySelector(".cat-fact");
        if (factElement) {
          factElement.innerHTML = `<strong>–§–∞–∫—Ç –æ –∫–æ—à–∫–∞—Ö:</strong> ${randomFact}`;
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
      function updatePlayersList(players) {
        if (!playersListEl) return;

        playersListEl.innerHTML = "";

        if (!Array.isArray(players)) {
          console.error("‚ùå players –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:", players);
          players = [];
        }

        if (players.length === 0) {
          const emptyItem = document.createElement("li");
          emptyItem.className = "player-item";
          emptyItem.innerHTML =
            '<span class="player-name">–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω</span>';
          playersListEl.appendChild(emptyItem);
          return;
        }

        players.forEach((player) => {
          if (!player || !player.id || !player.name) {
            console.warn("‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞:", player);
            return;
          }

          const playerItem = document.createElement("li");
          const isMe = player.id === currentPlayerId;
          const isSelected =
            selectedOpponent && selectedOpponent.id === player.id;

          playerItem.className = `player-item ${isMe ? "me" : ""} ${
            isSelected ? "selected" : ""
          }`;
          playerItem.innerHTML = `
      <span class="player-name">${player.name} ${isMe ? "(–í—ã)" : ""}</span>
      <span class="player-resources">${formatNumber(
        player.resources || 0
      )}</span>
    `;

          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã–∑–æ–≤–∞ –Ω–∞ –±–æ–π (—Ç–æ–ª—å–∫–æ –Ω–µ –¥–ª—è —Å–µ–±—è)
          if (!isMe) {
            playerItem.style.cursor = "pointer";
            playerItem.title = "–ö–ª–∏–∫–Ω–∏—Ç–µ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –¥–ª—è –±–∏—Ç–≤—ã";
            playerItem.addEventListener("click", () => {
              // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
              document.querySelectorAll(".player-item").forEach((item) => {
                item.classList.remove("selected");
              });

              // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
              playerItem.classList.add("selected");

              selectedOpponent = player;
              showNotification(`–í—ã–±—Ä–∞–Ω –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫: ${player.name}`);

              // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤—ã–∑–æ–≤–∞ –Ω–∞ –±–æ–π
              updateBattleButtons();
            });
          }

          playersListEl.appendChild(playerItem);
        });
      }

      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function fetchTasks() {
          const container = document.getElementById('tasks-list');
          if (!container) return;
          container.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...';

          socket && socket.emit('get-my-tasks', {}, (res) => {
            if (!res || !res.ok) {
              container.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è';
              return;
            }

            const tasks = res.tasks || [];
            container.innerHTML = '';
            if (tasks.length === 0) {
              container.textContent = '–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π';
              return;
            }

            tasks.forEach(task => {
              const div = document.createElement('div');
              div.style.padding = '8px';
              div.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
              const statusText = task.status === 'completed' ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ';
              const last = task.lastCompletedAt ? ` (–ø–æ—Å–ª–µ–¥–Ω—è—è: ${new Date(task.lastCompletedAt).toLocaleString()})` : '';
              div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;"><div><strong>${task.title}</strong><div style='font-size:0.8rem;color:#a1c4fd'>${task.description}</div><div style='font-size:0.75rem;color:#a1c4fd'>${statusText}${last}</div></div><div style='text-align:right'><div style='font-weight:bold'>${task.reward}üêü</div><button class='upgrade-btn small' data-claim='${task.id}' ${task.claimable ? '' : 'disabled'}>${task.claimable ? '–ó–∞–±—Ä–∞—Ç—å' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'}</button></div></div>`;
              container.appendChild(div);
            });

            container.querySelectorAll('button[data-claim]').forEach(btn => {
              btn.addEventListener('click', () => {
                const taskId = btn.getAttribute('data-claim');
                socket.emit('claim-task', { taskId }, (res) => {
                  if (res && res.ok) {
                    showNotification('–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞');
                    // refresh players/leaderboard and tasks
                    socket.emit('get-players');
                    fetchLeaderboard();
                    fetchTasks();
                  } else {
                    showNotification('–û—à–∏–±–∫–∞: ' + (res && res.error));
                    // refresh tasks to reflect accurate state
                    fetchTasks();
                  }
                });
              });
            });
          });
        }
      function performAttack() {
        if (!inBattle || !socket) return;

        const battleId = getCurrentBattleId();
        if (!battleId) {
          showNotification("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞—Ç—Ç–ª–∞!");
          return;
        }

        socket.emit("battle-attack", {
          battleId: battleId,
          isSpecial: false,
        });
      }

      function performSpecialAttack() {
        if (!inBattle || !socket) return;

        const battleId = getCurrentBattleId();
        if (!battleId) {
          showNotification("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞—Ç—Ç–ª–∞!");
          return;
        }

        socket.emit("battle-attack", {
          battleId: battleId,
          isSpecial: true,
        });
      }

      // –í—ã–∑–æ–≤ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –±–æ–π
      function challengePlayer() {
        if (!selectedOpponent) {
          showNotification("–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞!");
          return;
        }

        if (!socket || !socket.connected) {
          showNotification("–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º!");
          return;
        }

        if (resources < 10) {
          showNotification("–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 10 —Ä—ã–±–æ–∫ –¥–ª—è –±–∏—Ç–≤—ã!");
          return;
        }

        socket.emit("battle-challenge", {
          targetId: selectedOpponent.id,
        });

        showNotification(`–í—ã–∑–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ${selectedOpponent.name}!`);
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ –≤—ã–∑–æ–≤–∞ –Ω–∞ –±–æ–π
      function handleBattleChallenge(challengeData) {
        if (
          confirm(
            `–ò–≥—Ä–æ–∫ ${challengeData.challenger.name} –≤—ã–∑—ã–≤–∞–µ—Ç –≤–∞—Å –Ω–∞ –±–æ–π! –ü—Ä–∏–Ω—è—Ç—å –≤—ã–∑–æ–≤?`
          )
        ) {
          socket.emit("battle-accept", {
            challengerId: challengeData.challenger.id,
          });
          showNotification("–í—ã –ø—Ä–∏–Ω—è–ª–∏ –≤—ã–∑–æ–≤ –Ω–∞ –±–æ–π!");
        } else {
          socket.emit("battle-decline", {
            challengerId: challengeData.challenger.id,
            reason: "–û—Ç–∫–ª–æ–Ω–µ–Ω–æ –∏–≥—Ä–æ–∫–æ–º",
          });
          showNotification("–í—ã –æ—Ç–∫–ª–æ–Ω–∏–ª–∏ –≤—ã–∑–æ–≤ –Ω–∞ –±–æ–π.");
        }
      }

      // –ù–∞—á–∞–ª–æ –±–∞—Ç—Ç–ª–∞
      function startBattle(battleData) {
        inBattle = true;
        playerHealth = battleData.player1.health;
        opponentHealth = battleData.player2.health;
        setCurrentBattleId(battleData.id);

        updateBattleUI(battleData);
        showNotification(
          `–ë–∏—Ç–≤–∞ –Ω–∞—á–∞–ª–∞—Å—å! –í—ã –ø—Ä–æ—Ç–∏–≤ ${battleData.player2.name}`
        );

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –±–∞—Ç—Ç–ª–∞
        updateBattleButtons(battleData);
      }

      function updateBattleLog(actions) {
        if (!battleLogEl) return;

        battleLogEl.innerHTML = "";

        actions.forEach((action) => {
          const eventEl = document.createElement("div");
          eventEl.className = `battle-event ${action.type}`;

          let message = "";
          switch (action.type) {
            case "attack":
              message = `üó°Ô∏è ${action.attacker} –∞—Ç–∞–∫—É–µ—Ç ${action.defender} –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${action.damage} —É—Ä–æ–Ω–∞`;
              break;
            case "special":
              message = `‚ö° ${action.attacker} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É–ø–µ—Ä-—É–¥–∞—Ä –ø—Ä–æ—Ç–∏–≤ ${action.defender} –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${action.damage} —É—Ä–æ–Ω–∞`;
              break;
            case "timeout":
              message = `‚è∞ ${action.player} –ø—Ä–æ–ø—É—Å—Ç–∏–ª —Ö–æ–¥ –∏ –ø–æ–ª—É—á–∞–µ—Ç ${action.damage} —É—Ä–æ–Ω–∞`;
              break;
            case "cancel":
              message = `‚ùå –ë–∞—Ç—Ç–ª –æ—Ç–º–µ–Ω–µ–Ω: ${action.reason}`;
              break;
            default:
              message = `‚ÑπÔ∏è ${JSON.stringify(action)}`;
          }

          if (action.battleEnd) {
            message += `\nüéâ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${action.winner}!`;
          }

          eventEl.textContent = message;
          battleLogEl.appendChild(eventEl);
        });

        battleLogEl.scrollTop = battleLogEl.scrollHeight;
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–∞—Ç—Ç–ª–∞
      function updateBattleUI(battleData) {
        if (!battleData) return;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
        const playerHealthPercent =
          (battleData.player1.health / battleData.player1.maxHealth) * 100;
        const opponentHealthPercent =
          (battleData.player2.health / battleData.player2.maxHealth) * 100;

        if (playerHealthBarEl)
          playerHealthBarEl.style.width = playerHealthPercent + "%";
        if (opponentHealthBarEl)
          opponentHealthBarEl.style.width = opponentHealthPercent + "%";
        if (playerHealthEl)
          playerHealthEl.textContent =
            battleData.player1.health + "/" + battleData.player1.maxHealth;
        if (opponentHealthEl)
          opponentHealthEl.textContent =
            battleData.player2.health + "/" + battleData.player2.maxHealth;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥ –±–∞—Ç—Ç–ª–∞
        updateBattleLog(battleData.actions);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
        updateBattleButtons(battleData);
      }

      // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–∞—Ç—Ç–ª–∞
      function endBattle(battleResult) {
        inBattle = false;
        playerHealth = 100;
        opponentHealth = 100;

        clearCurrentBattleId();

        showNotification(`–ë–∏—Ç–≤–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${battleResult.winner}`);

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∞—Ç—Ç–ª–∞
        updateBattleUI({
          player1: { health: 100, maxHealth: 100 },
          player2: { health: 100, maxHealth: 100 },
          actions: [],
        });

        updateBattleButtons(null);
      }

      // ========== –ö–û–ù–ï–¶ –î–û–ë–ê–í–õ–ï–ù–ù–´–• –§–£–ù–ö–¶–ò–ô ==========

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ —Å–∏—Å—Ç–µ–º—ã
      function initAudio() {
        try {
          // –ü–æ–ª—É—á–∞–µ–º –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã
          backgroundMusic = document.getElementById("background-music");
          clickSound = document.getElementById("click-sound");
          upgradeSound = document.getElementById("upgrade-sound");
          battleSound = document.getElementById("battle-sound");
          victorySound = document.getElementById("victory-sound");
          notificationSound = document.getElementById("notification-sound");

          // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
          musicToggleBtn = document.getElementById("music-toggle");
          sfxToggleBtn = document.getElementById("sfx-toggle");
          volumeSlider = document.getElementById("volume-slider");
          audioInitOverlay = document.getElementById("audioInitOverlay");
          audioControls = document.getElementById("audioControls");
          enableAudioBtn = document.getElementById("enableAudioBtn");
          disableAudioBtn = document.getElementById("disableAudioBtn");

          // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
          preloadAudio();

          // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å
          updateVolume();

          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
          enableAudioBtn.addEventListener("click", enableAudio);
          disableAudioBtn.addEventListener("click", disableAudio);

          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
          loadAudioSettings();

          console.log("–ê—É–¥–∏–æ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏");
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ:", error);
          hideAudioOverlay();
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –±–∞—Ç—Ç–ª–∞
      function updateBattleButtons() {
        if (!challengeBtnEl) return;

        if (selectedOpponent) {
          challengeBtnEl.disabled = false;
          challengeBtnEl.textContent = `–í—ã–∑–≤–∞—Ç—å ${selectedOpponent.name}`;
        } else {
          challengeBtnEl.disabled = true;
          challengeBtnEl.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞";
        }
      }

      // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞—Ç–∞–∫–∏
      function performAttack() {
        if (!inBattle || !socket) return;

        socket.emit("battle-attack", {
          battleId: getCurrentBattleId(),
          isSpecial: false,
        });
      }

      // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
      function preloadAudio() {
        const audioElements = [
          backgroundMusic,
          clickSound,
          upgradeSound,
          battleSound,
          victorySound,
          notificationSound,
        ];

        audioElements.forEach((audio) => {
          if (audio) {
            audio.preload = "auto";
            // –î–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∞—É–¥–∏–æ
            audio.load();
          }
        });
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
      function updateVolume() {
        if (!volumeSlider) return;

        volume = parseInt(volumeSlider.value) / 100;

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const audioElements = [
          backgroundMusic,
          clickSound,
          upgradeSound,
          battleSound,
          victorySound,
          notificationSound,
        ];

        audioElements.forEach((audio) => {
          if (audio) audio.volume = volume;
        });

        saveAudioSettings();
      }

      // –°–∫—Ä—ã—Ç–∏–µ –æ–≤–µ—Ä–ª–µ—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ
      function hideAudioOverlay() {
        if (audioInitOverlay) {
          audioInitOverlay.style.display = "none";
        }
      }

      // –í–∫–ª—é—á–µ–Ω–∏–µ –∞—É–¥–∏–æ
      function enableAudio() {
        musicEnabled = true;
        sfxEnabled = true;
        audioInitialized = true;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–ª–æ–∫–µ
        audioControls.style.display = "flex";

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        musicToggleBtn.addEventListener("click", toggleMusic);
        sfxToggleBtn.addEventListener("click", toggleSFX);
        volumeSlider.addEventListener("input", updateVolume);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        updateAudioUI();

        // –°–∫—Ä—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        hideAudioOverlay();

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        saveAudioSettings();

        showNotification(
          "–ê—É–¥–∏–æ –≤–∫–ª—é—á–µ–Ω–æ! –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∏–≥—Ä–µ —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É! üéµ"
        );

        // –ü—ã—Ç–∞–µ–º—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç
        initAudioContext();
      }

      // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞—É–¥–∏–æ
      function disableAudio() {
        musicEnabled = false;
        sfxEnabled = false;
        audioInitialized = true;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ (–Ω–æ –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–µ)
        audioControls.style.display = "flex";

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        musicToggleBtn.addEventListener("click", toggleMusic);
        sfxToggleBtn.addEventListener("click", toggleSFX);
        volumeSlider.addEventListener("input", updateVolume);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        updateAudioUI();

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º—É–∑—ã–∫—É –µ—Å–ª–∏ –∏–≥—Ä–∞–µ—Ç
        if (backgroundMusic) {
          backgroundMusic.pause();
        }

        // –°–∫—Ä—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        hideAudioOverlay();

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        saveAudioSettings();

        showNotification(
          "–ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ç–∏—Ö–æ–º —Ä–µ–∂–∏–º–µ. –í—ã –º–æ–∂–µ—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è! üîá"
        );
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      function initAudioContext() {
        try {
          // –°–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
          if (!audioContext) {
            audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
          }
        } catch (error) {
          console.log("–ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:", error);
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∞—É–¥–∏–æ
      function updateAudioUI() {
        if (!musicToggleBtn || !sfxToggleBtn) return;

        if (musicEnabled) {
          musicToggleBtn.classList.remove("muted");
          musicToggleBtn.textContent = "üéµ";
        } else {
          musicToggleBtn.classList.add("muted");
          musicToggleBtn.textContent = "üîá";
        }

        if (sfxEnabled) {
          sfxToggleBtn.classList.remove("muted");
          sfxToggleBtn.textContent = "üîä";
        } else {
          sfxToggleBtn.classList.add("muted");
          sfxToggleBtn.textContent = "üîá";
        }
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º—É–∑—ã–∫–∏
      function toggleMusic() {
        musicEnabled = !musicEnabled;

        if (musicEnabled) {
          // –ï—Å–ª–∏ –º—É–∑—ã–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, –ø—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
          if (userInteracted) {
            playBackgroundMusic();
          }
        } else {
          // –ï—Å–ª–∏ –º—É–∑—ã–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
          if (backgroundMusic) {
            backgroundMusic.pause();
          }
        }

        updateAudioUI();
        saveAudioSettings();
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
      function toggleSFX() {
        sfxEnabled = !sfxEnabled;
        updateAudioUI();
        saveAudioSettings();
      }

      // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
      function playBackgroundMusic() {
        if (!musicEnabled || !backgroundMusic || !userInteracted) return;

        try {
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
          if (audioContext && audioContext.state === "suspended") {
            audioContext.resume();
          }

          backgroundMusic.volume = volume;
          backgroundMusic.currentTime = 0;
          backgroundMusic.play().catch((error) => {
            console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:", error);
            musicPlayAttempted = true;
          });
          isMusicPlaying = true;
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –º—É–∑—ã–∫–∏:", error);
        }
      }

      // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
      function playSound(soundElement) {
        if (!sfxEnabled || !soundElement || !userInteracted) return;

        try {
          soundElement.volume = volume;
          soundElement.currentTime = 0;
          soundElement.play().catch((error) => {
            console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", error);
          });
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", error);
        }
      }

      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞—É–¥–∏–æ
      function saveAudioSettings() {
        try {
          localStorage.setItem(
            "audioSettings",
            JSON.stringify({
              musicEnabled: musicEnabled,
              sfxEnabled: sfxEnabled,
              volume: volume,
              audioInitialized: audioInitialized,
            })
          );
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞—É–¥–∏–æ:", error);
        }
      }

      // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞—É–¥–∏–æ
      function loadAudioSettings() {
        try {
          const savedSettings = localStorage.getItem("audioSettings");
          if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            musicEnabled = settings.musicEnabled || false;
            sfxEnabled = settings.sfxEnabled || false;
            volume = settings.volume || 0.5;
            audioInitialized = settings.audioInitialized || false;

            // –ï—Å–ª–∏ –∞—É–¥–∏–æ —É–∂–µ –±—ã–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, —Å–∫—Ä—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
            if (audioInitialized) {
              hideAudioOverlay();
              audioControls.style.display = "flex";
              updateAudioUI();
            }
          }
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞—É–¥–∏–æ:", error);
        }
      }

      function getCurrentBattleId() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π –±–∞—Ç—Ç–ª
        if (!inBattle || !currentBattleId) {
          console.warn("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞—Ç—Ç–ª–∞");
          return null;
        }

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –±–∞—Ç—Ç–ª –≤—Å–µ –µ—â–µ –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        if (socket && socket.connected) {
          // –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –±–∞—Ç—Ç–ª–∞
          socket.emit("battle-info", { battleId: currentBattleId });
        }

        return currentBattleId;
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ID –±–∞—Ç—Ç–ª–∞
      function setCurrentBattleId(battleId) {
        currentBattleId = battleId;
        console.log("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ID –±–∞—Ç—Ç–ª–∞:", battleId);
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ ID –±–∞—Ç—Ç–ª–∞
      function clearCurrentBattleId() {
        console.log("–û—á–∏—â–µ–Ω ID –±–∞—Ç—Ç–ª–∞:", currentBattleId);
        currentBattleId = null;
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –±–∞—Ç—Ç–ª–∞
      function hasActiveBattle() {
        return inBattle && currentBattleId !== null;
      }

      function saveGame() {
        try {
          const gameData = {
            resources: resources,
            clickPower: clickPower,
            autoPower: autoPower,
            currentSkin: currentSkin,
            ownedSkins: ownedSkins,
            playerName: playerName,
            upgrades: upgrades,
            boostActive: boostActive,
            boostTimeLeft: boostTimeLeft,
            // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º currentBattleId, —Ç–∞–∫ –∫–∞–∫ –±–∞—Ç—Ç–ª—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ
            lastSave: Date.now(),
          };
          localStorage.setItem("kosatkaClicker", JSON.stringify(gameData));
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã:", error);
        }
      }

      // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
      function loadGame() {
        try {
          const savedGame = localStorage.getItem("kosatkaClicker");
          if (savedGame) {
            const gameData = JSON.parse(savedGame);
            resources = gameData.resources || 0;
            clickPower = gameData.clickPower || 1;
            autoPower = gameData.autoPower || 0;
            currentSkin = gameData.currentSkin || "default";
            ownedSkins = gameData.ownedSkins || ["default"];
            playerName = gameData.playerName || playerName;

            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —É–ª—É—á—à–µ–Ω–∏—è
            if (gameData.upgrades) {
              upgrades.forEach((upgrade, index) => {
                const savedUpgrade = gameData.upgrades.find(
                  (u) => u.id === upgrade.id
                );
                if (savedUpgrade) {
                  upgrade.cost = savedUpgrade.cost || upgrade.cost;
                  upgrade.owned = savedUpgrade.owned || 0;
                }
              });
            }

            boostActive = gameData.boostActive || false;
            boostTimeLeft = gameData.boostTimeLeft || 0;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫–∏–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ ownedSkins
            skins.forEach((skin) => {
              skin.owned = ownedSkins.includes(skin.id);
            });

            console.log("–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ localStorage");
            return true;
          }
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã:", error);
        }
        return false;
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
      function initGame() {
        console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...");

        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
        resourcesEl = document.getElementById("resources");
        clickPowerEl = document.getElementById("click-power");
        autoPowerEl = document.getElementById("auto-power");
        kosatkaEl = document.getElementById("kosatka");
        kosatkaSkinEl = document.getElementById("kosatka-skin");
        upgradesEl = document.getElementById("upgrades");
        skinsGridEl = document.getElementById("skins-grid");
        playersListEl = document.getElementById("players-list");
        notificationEl = document.getElementById("notification");
        boostIndicatorEl = document.getElementById("boost-indicator");
        connectionStatusEl = document.getElementById("connectionStatus");
        chatMessagesEl = document.getElementById("chat-messages");
        chatInputEl = document.getElementById("chat-input");
        chatSendEl = document.getElementById("chat-send");
        battleActionsEl = document.getElementById("battle-actions");
        battleLogEl = document.getElementById("battle-log");
        attackBtnEl = document.getElementById("attack-btn");
        specialBtnEl = document.getElementById("special-btn");
        challengeBtnEl = document.getElementById("challenge-btn");
        playerHealthEl = document.getElementById("player-health");
        opponentHealthEl = document.getElementById("opponent-health");
        playerHealthBarEl = document.getElementById("player-health-bar");
        opponentHealthBarEl = document.getElementById("opponent-health-bar");

        audioControls = document.getElementById("audioControls");
        musicToggleBtn = document.getElementById("music-toggle");
        sfxToggleBtn = document.getElementById("sfx-toggle");
        volumeSlider = document.getElementById("volume-slider");

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É
        loadGame();

        // –°–æ–∑–¥–∞–µ–º —É–ª—É—á—à–µ–Ω–∏—è –∏ —Å–∫–∏–Ω—ã
        createUpgrades();
        createSkins();

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        if (kosatkaEl) {
          kosatkaEl.addEventListener("click", clickKosatka);
        }

        if (chatSendEl) {
          chatSendEl.addEventListener("click", sendChatMessage);
        }

        if (chatInputEl) {
          chatInputEl.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              sendChatMessage();
            }
          });
        }

        if (attackBtnEl) {
          attackBtnEl.addEventListener("click", performAttack);
        }

        if (specialBtnEl) {
          specialBtnEl.addEventListener("click", performSpecialAttack);
        }

        if (challengeBtnEl) {
          challengeBtnEl.addEventListener("click", challengePlayer);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        document.addEventListener("click", function () {
          if (!userInteracted) {
            userInteracted = true;
            // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –º—É–∑—ã–∫—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞
            if (musicEnabled) {
              playBackgroundMusic();
            }
          }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        updateUI();

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–∫—Ç –æ –∫–æ—à–∫–∞—Ö
        showRandomCatFact();

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        setInterval(gameLoop, 1000);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
        initSocketConnection();

        gameInitialized = true;
        console.log("–ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!");
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
      function initSocketConnection() {
        try {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
          connectionStatusEl.textContent = "–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...";
          connectionStatusEl.className = "connection-status disconnected";

          // –û–±–Ω–æ–≤–ª—è–µ–º URL —Å–µ—Ä–≤–µ—Ä–∞
          // Prefer explicit SERVER_URL if set (when client hosted separately), otherwise use the same origin
          const socketBase = 'https://cosatkaclickmserv-7.onrender.com';
          socket = io(socketBase, {
            transports: ["websocket", "polling"],
            timeout: 10000,
            reconnection: true,
            reconnectionAttempts: 5,
            reconnectionDelay: 1000,
          });

          socket.on("connect", () => {
            console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É");
            connectionStatusEl.textContent = "–ü–æ–¥–∫–ª—é—á–µ–Ω";
            connectionStatusEl.className = "connection-status connected";

            // expose server base URL for fetch calls
            // try {
            //   // If page was served from server, it will already be correct; set SERVER_URL only if absent
            //   if (!window.SERVER_URL) window.SERVER_URL = socketBase;
            // } catch (e) {
            //   console.warn('Unable to set SERVER_URL', e);
            // }

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∏–≥—Ä–æ–∫–µ
            socket.emit("player-join", {
              name: playerName,
              resources: resources,
              clickPower: clickPower,
              autoPower: autoPower,
              currentSkin: currentSkin,
              ownedSkins: ownedSkins,
            });

            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
            socket.emit("get-players");
          });

          socket.on("player-registered", (data) => {
            console.log("üéÆ –ò–≥—Ä–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:", data);
            currentPlayerId = data.id;
            playerName = data.name;

            // Persist server-assigned name back to localStorage so it doesn't change repeatedly
            try {
              const obj = JSON.parse(localStorage.getItem('kosatkaClicker') || '{}');
              obj.playerName = playerName;
              localStorage.setItem('kosatkaClicker', JSON.stringify(obj));
            } catch (e) {
              // ignore
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            updateUI();
          });

          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
          socket.on("players-update", (playersList) => {
            console.log("üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤:", playersList.length);
            if (Array.isArray(playersList)) {
              updatePlayersList(playersList);
            } else {
              console.error(
                "‚ùå –ü–æ–ª—É—á–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤:",
                playersList
              );
              updatePlayersList([]);
            }
          });

          socket.on("chat-message", (messageData) => {
            if (messageData && messageData.playerName && messageData.message) {
              addChatMessage(
                messageData.playerName,
                messageData.message,
                messageData.timestamp || new Date().toLocaleTimeString()
              );
            }
          });

          socket.on("player-joined", (playerData) => {
            if (playerData && playerData.name) {
              showNotification(
                `–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ç ${playerData.name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è!`
              );

              // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
              if (socket.connected) {
                socket.emit("get-players");
              }
            }
          });

          socket.on("player-left", (playerData) => {
            if (playerData && playerData.name) {
              showNotification(
                `–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ç ${playerData.name} –ø–æ–∫–∏–Ω—É–ª –∏–≥—Ä—É!`
              );

              // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
              if (socket.connected) {
                socket.emit("get-players");
              }
            }
          });

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–∞—Ç—Ç–ª–æ–≤
          socket.on("battle-challenge", handleBattleChallenge);
          socket.on("battle-start", startBattle);
          socket.on("battle-update", updateBattleUI);
          socket.on("battle-ended", endBattle);
          socket.on("battle-error", (error) => {
            showNotification(`–û—à–∏–±–∫–∞ –±–∞—Ç—Ç–ª–∞: ${error.message}`);
          });
          socket.on("battle-cancelled", (data) => {
            inBattle = false;
            clearCurrentBattleId();
            showNotification(`–ë–∞—Ç—Ç–ª –æ—Ç–º–µ–Ω–µ–Ω: ${data.reason}`);

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateBattleUI({
              player1: { health: 100, maxHealth: 100 },
              player2: { health: 100, maxHealth: 100 },
              actions: [],
            });
            updateBattleButtons(null);
          });

          socket.on("disconnect", (reason) => {
            console.log("‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", reason);
            connectionStatusEl.textContent = "–û—Ç–∫–ª—é—á–µ–Ω";
            connectionStatusEl.className = "connection-status disconnected";

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
            updatePlayersList([]);
            addChatMessage(
              "–°–∏—Å—Ç–µ–º–∞",
              "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ—Ç–µ—Ä—è–Ω–æ. –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...",
              new Date().toLocaleTimeString()
            );
          });

          socket.on("connect_error", (error) => {
            console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:", error);
            connectionStatusEl.textContent = "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è";
            connectionStatusEl.className = "connection-status disconnected";

            // –†–∞–±–æ—Ç–∞–µ–º –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ
            updatePlayersList([]);
            addChatMessage(
              "–°–∏—Å—Ç–µ–º–∞",
              "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –†–µ–∂–∏–º –æ—Ñ—Ñ–ª–∞–π–Ω.",
              new Date().toLocaleTimeString()
            );
          });

          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞
          socket.on("error", (error) => {
            console.error("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:", error);
            showNotification("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
          });
        } catch (error) {
          console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–∫–µ—Ç–∞:", error);
          connectionStatusEl.textContent = "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏";
          connectionStatusEl.className = "connection-status disconnected";

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
          updatePlayersList([]);
          addChatMessage(
            "–°–∏—Å—Ç–µ–º–∞",
            "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É",
            new Date().toLocaleTimeString()
          );
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
      async function checkServerStatus() {
        try {
          const response = await fetch(
            "https://cosatkaclickmserv-7.onrender.com/status"
          );
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          console.log("üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞:", data);
          return data.status === "online";
        } catch (error) {
          console.error("‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:", error);
          return false;
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.addEventListener("DOMContentLoaded", function () {
        console.log("üéÆ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...");

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
        checkServerStatus().then((isOnline) => {
          if (isOnline) {
            console.log("‚úÖ –°–µ—Ä–≤–µ—Ä –æ–Ω–ª–∞–π–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É...");
            initAudio();
            initGame();
          } else {
            console.log("‚ùå –°–µ—Ä–≤–µ—Ä –æ—Ñ—Ñ–ª–∞–π–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –≤ –æ–¥–∏–Ω–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ");
            initAudio();
            initGame();
            showNotification("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –†–µ–∂–∏–º –æ—Ñ—Ñ–ª–∞–π–Ω.");
          }
        
        // New features: leaderboard, clans, tasks
        (function() {
          const base = 'https://cosatkaclickmserv-7.onrender.com';

          function fetchLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            if (!list) return;
            list.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            fetch(base + '/leaderboard')
              .then(r => r.json())
              .then(data => {
                list.innerHTML = '';
                const rows = (data && data.leaderboard) || [];
                if (!rows.length) {
                  list.innerHTML = '<li>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</li>';
                  return;
                }
                rows.forEach((p, idx) => {
                  const li = document.createElement('li');
                  li.style.display = 'flex';
                  li.style.justifyContent = 'space-between';
                  li.style.alignItems = 'center';
                  li.style.padding = '6px 4px';
                  const left = document.createElement('div');
                  left.style.display = 'flex';
                  left.style.alignItems = 'center';
                  const rank = document.createElement('span');
                  rank.textContent = `#${idx + 1}`;
                  rank.style.width = '40px';
                  rank.style.marginRight = '8px';
                  const name = document.createElement('span');
                  name.textContent = p.name;
                  name.style.flex = '1';
                  left.appendChild(rank);
                  left.appendChild(name);
                  const right = document.createElement('div');
                  right.textContent = `${p.resources} üêü`;
                  li.appendChild(left);
                  li.appendChild(right);
                  // highlight current player
                  try {
                    if (p.name === playerName || p.id === currentPlayerId) {
                      li.style.background = 'linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))';
                      li.style.borderRadius = '6px';
                      li.style.fontWeight = '700';
                    }
                  } catch (e) {}
                  list.appendChild(li);
                });
              })
              .catch(err => {
                console.error('leaderboard fetch error', err);
                list.innerHTML = '<li>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</li>';
              });
          }

          function fetchClans() {
            const container = document.getElementById('clans-list');
            if (!container) return;
            container.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            fetch(base + '/clans')
              .then(r => r.json())
              .then(data => {
                container.innerHTML = '';
                const clans = (data && data.clans) || [];
                if (!clans.length) {
                  container.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç –∫–ª–∞–Ω–æ–≤';
                  return;
                }
                clans.forEach(clan => {
                  const div = document.createElement('div');
                  div.style.padding = '8px';
                  div.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
                  // members names
                  const members = (clan.members || []).map(m => m.name).join(', ');
                  const ownerName = (clan.members || []).find(m => m.role === 'owner') ? ( (clan.members || []).find(m => m.role === 'owner').name ) : (clan.ownerId || '‚Äî');
                  div.innerHTML = `<div style='display:flex;justify-content:space-between;align-items:flex-start;gap:12px;'><div style='flex:1;min-width:0;'><strong style='display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>${clan.name}</strong><div style='font-size:0.8rem;color:#a1c4fd;margin-top:4px;'>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${clan.members.length}</div><div style='font-size:0.75rem;color:#a1c4fd;margin-top:4px;'>–í–ª–∞–¥–µ–ª–µ—Ü: ${ownerName}</div><div style='margin-top:6px;font-size:0.85rem;color:#cbd5e1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>${members ? '–£—á–∞—Å—Ç–Ω–∏–∫–∏: ' + members : ''}</div></div><div class='clan-controls' style='min-width:120px;text-align:right;'></div></div>`;
                  container.appendChild(div);
                });

                // attach controls
                container.querySelectorAll('.clan-controls').forEach((ctrl, i) => {
                  const clanObj = clans[i];
                  if (!clanObj) return;
                  const isOwner = clanObj.ownerId === currentPlayerId;
                  const isMember = (clanObj.members || []).some(m => m.id === currentPlayerId);
                  if (isOwner) {
                    ctrl.innerHTML = '<span style="font-weight:700;color:#ffd700;">–í—ã ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü</span>';
                  } else if (isMember) {
                    const leave = document.createElement('button');
                    leave.className = 'upgrade-btn small';
                    leave.textContent = '–í—ã–π—Ç–∏';
                    leave.addEventListener('click', () => {
                      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∫–ª–∞–Ω–∞? (–§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)')) return;
                      showNotification('–§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');
                      fetchClans();
                    });
                    ctrl.appendChild(leave);
                  } else {
                    const join = document.createElement('button');
                    join.className = 'upgrade-btn small';
                    join.textContent = '–í—Å—Ç—É–ø–∏—Ç—å';
                    join.addEventListener('click', () => {
                      socket.emit('join-clan', { clanId: clanObj.id }, (res) => {
                        if (res && res.ok) {
                          showNotification('–í—ã –≤—Å—Ç—É–ø–∏–ª–∏ –≤ –∫–ª–∞–Ω');
                          fetchClans();
                        } else {
                          showNotification('–û—à–∏–±–∫–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è: ' + (res && res.error));
                        }
                      });
                    });
                    ctrl.appendChild(join);
                  }
                });
              }).catch(err => {
                console.error('clans fetch error', err);
                container.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∞–Ω–æ–≤';
              });
          }

          function createClan(name) {
            socket.emit('create-clan', { name }, (res) => {
              if (res && res.ok) {
                showNotification('–ö–ª–∞–Ω —Å–æ–∑–¥–∞–Ω');
                fetchClans();
              } else {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–Ω–∞: ' + (res && res.error));
              }
            });
          }

          function fetchTasks() {
            const container = document.getElementById('tasks-list');
            if (!container) return;
            container.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...';

            socket && socket.emit('get-my-tasks', {}, (res) => {
              if (!res || !res.ok) {
                container.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è';
                return;
              }

              const tasks = res.tasks || [];
              container.innerHTML = '';
              if (tasks.length === 0) {
                container.textContent = '–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π';
                return;
              }

              tasks.forEach(task => {
                const div = document.createElement('div');
                div.style.padding = '8px';
                div.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
                const statusText = task.status === 'completed' ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ';
                const last = task.lastCompletedAt ? ` (–ø–æ—Å–ª–µ–¥–Ω—è—è: ${new Date(task.lastCompletedAt).toLocaleString()})` : '';
                div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;"><div><strong>${task.title}</strong><div style='font-size:0.8rem;color:#a1c4fd'>${task.description}</div><div style='font-size:0.75rem;color:#a1c4fd'>${statusText}${last}</div></div><div style='text-align:right'><div style='font-weight:bold'>${task.reward}üêü</div><button class='upgrade-btn small' data-claim='${task.id}' ${task.claimable ? '' : 'disabled'}>${task.claimable ? '–ó–∞–±—Ä–∞—Ç—å' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'}</button></div></div>`;
                container.appendChild(div);
              });

              container.querySelectorAll('button[data-claim]').forEach(btn => {
                btn.addEventListener('click', () => {
                  const taskId = btn.getAttribute('data-claim');
                  socket.emit('claim-task', { taskId }, (res) => {
                    if (res && res.ok) {
                      showNotification('–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞');
                      socket.emit('get-players');
                      fetchLeaderboard();
                      fetchTasks();
                    } else {
                      showNotification('–û—à–∏–±–∫–∞: ' + (res && res.error));
                      fetchTasks();
                    }
                  });
                });
              });
            });
          }

          // Wire up buttons
          const rb = document.getElementById('refresh-leaderboard');
          if (rb) rb.addEventListener('click', fetchLeaderboard);
          // Nickname input wiring
          const nickInput = document.getElementById('custom-nick');
          const saveNickBtn = document.getElementById('save-nick');
          if (nickInput) {
            // Populate from localStorage if present
            try {
              const saved = JSON.parse(localStorage.getItem('kosatkaClicker') || '{}');
              if (saved && saved.playerName) nickInput.value = saved.playerName;
            } catch (e) {}
          }
          if (saveNickBtn && nickInput) {
            saveNickBtn.addEventListener('click', () => {
              const v = nickInput.value.trim();
              if (!v) return showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç–µ –ø–æ–ª–µ –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏');
              // update local playerName and persist
              playerName = v;
              try {
                const obj = JSON.parse(localStorage.getItem('kosatkaClicker') || '{}');
                obj.playerName = playerName;
                localStorage.setItem('kosatkaClicker', JSON.stringify(obj));
              } catch (e) {}
              // Notify server about name change by re-sending player-join info
              try {
                socket && socket.emit('player-join', {
                  name: playerName,
                  resources: resources,
                  clickPower: clickPower,
                  autoPower: autoPower,
                  currentSkin: currentSkin,
                  ownedSkins: ownedSkins,
                });
                showNotification('–ù–∏–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
              } catch (e) {
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä');
              }
            });
          }
          const createBtn = document.getElementById('create-clan');
          const newClanName = document.getElementById('new-clan-name');
          if (createBtn && newClanName) {
            createBtn.addEventListener('click', () => {
              const name = newClanName.value.trim();
              if (!name) return showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞');
              if (!confirm(`–°–æ–∑–¥–∞—Ç—å –∫–ª–∞–Ω "${name}"?`)) return;
              createClan(name);
            });
          }

          // Listen for clan updates and players updates from server to refresh UI
          socket && socket.on('clans-updated', () => fetchClans());
          socket && socket.on('players-update', () => {
            fetchLeaderboard();
          });

          // Initial fetches
          fetchLeaderboard();
          fetchClans();
          fetchTasks();
        })();
  });
      });
    </script>
  </body>
</html>
